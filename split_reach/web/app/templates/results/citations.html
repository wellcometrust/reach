{% extends 'base.html' %}

{% set status = es_status %}
{% if es_response is mapping %}
    {% set status = status and (es_response.hits.total.value > 0) %}
{% endif %}

{% block header %}

<header class="navbar">
  <section class="navbar-section">
        <a href="/" class="navbar-brand"><h2>Reach</h2></a>
  </section>
  <section class="navbar-section hide-md" id="navbar-links">
    <a href="/about" class="a-light">About Reach</a>
    <a href="/how-it-works" class="a-light">How Reach works</a>
    <a href="/search/citations" class="a-light active">Discover citations</a>
    <a href="/search/policy-docs" class="a-light">Browse policy documents</a>
  </section>
</header>

{% endblock %}

{% block main %}

<section id="breadcrumbs">
    <div class="breadcrumb-box">
        <ul class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Home</a></li>
            <li class="breadcrumb-item">Discover citations</li>
        </ul>
    </div>
</section>

<section id="citations-results" class="results-box">
    <div class="container">
        <hr class="hs">
        <div class="columns">
                <div class="column col-12 col-md-12">
                    <h1>Results for "{{ term }}" in citations</h1>
                </div>
            <div class="column col-12 col-md-12">
                <p>Search by scientific publication title, journal, author, policy organisation or policy document title</p>
            </div>
            <div class="column col-6 col-md-12">
                <form action="/search/citations">
                    <div class="input-group">
                      <input type="text" class="form-input input-xl" placeholder="Search" name="terms" id="search-term" value="{{ terms }}">
                      <button type="submit" class="btn btn-primary input-group-btn input-btn-xl">Discover citations <span class="icn icn-search"></span></button>
                    </div>
                </form>
            </div>
            {% if status %}
            <div class="column col-6 col-md-12 text-right">
                <a class="btn btn-primary btn-xl" href="/search/citations/csv?terms={{ term }}">Download results as .csv <span class="icn icn-download"></span></a>
                <!-- To be uncommented with further UI updates
                <a class="btn btn-primary btn-xl btn-download" href="/search/citations/json?terms={{ term }}" >Download results as .json <span class="icn icn-download"></span></a>
                -->
            </div>
            {% else %}
            <div class="column col-6 hide-md"></div>
            {% endif %}
        </div>
        {% if not status %}
            <hr class="fs">
            <div class="columns">
                <div class="column col-6 col-md-12">
                    <h3>We couldn’t find any results for your search.</h3>
                </div>
                <div class="column col-6 hide-md"></div>
            </div>
            <hr class="fs">
            <hr class="fs">
            <div class="columns">
                <div class="column col-6 col-md-12">
                    <div class="feedback-box">
                        <p class="bold">Can't find what you're looking for?</p>
                        <p>If something doesn’t look quite right, please get in touch with the team at <a href="mailto:reach@wellcome.ac.uk">reach@wellcome.ac.uk.</a></p>
                    </div>
                </div>
                <div class="column col-6 hide-md"></div>
            </div>
            <hr class="fs">
        </div>
        {% else %}
            </div>
            <div class="fs"></div>
            <div class="results">
                <div class="container">
                    <div class="results-pages">
                        <div class="columns">
                            <div class="column col-6 col-md-12">
                                <div class="page-counter">
                                    {#- Updated dynamically in JS #}
                                </div>
                            </div>
                            <div class="column col-6 col-md-12">
                                <div class="pagination-box float-right" id="pagination-box">
                                    {#- Updated dynamically in JS #}
                                </div>
                            </div>
                        </div>
                    </div>

                    <table class="table table-light table-striped table-hover"  id="citations-result-table">
                        <colgroup>
                            <col class="colgroup-accordion-col">
                            <col class="colgroup-large-col">
                            <col class="colgroup-medium-col">
                            <col class="colgroup-medium-col">
                            <col class="colgroup-small-col">
                            <col class="colgroup-small-col">
                        </colgroup>
                        <thead>
                            <tr>
                                <th></th>
                                <th class="sort" data-sort="match_title.keyword" data-order="asc" id="active-sort"><span class="icn icn-research-paper"></span> Research publication <span class="icn icn-sort"></th>
                                <th class="sort" data-sort="match_publication">Journal <span class="icn icn-sort"></span></th>
                                <th>Author(s)</th>
                                <th class="sort" data-sort="match_pub_year">Publication Year <span class="icn icn-sort"></span></th>
                                <th class="sort" data-sort="associated_policies_count">Citations in policy docs  <span class="icn icn-sort"></span></th>
                            </tr>
                        </thead>
                        <tbody id="citations-results-tbody">


<!--
                            <tr class="accordion-row active-row" id="accordion-row-${item._source.doc.reference_id}">
                            <td class="accordion-arrow"><i class="icon icon-arrow-down mr-1"></i></td>
                            <td title="${match_title}">Foo</td>
                            <td>Bar</td>
                            <td class="authors-cell" title="${authors}">
                                Foo, Bar, Baz
                            </td>
                            <td>2020</td>
                            <td>1</td>
                            </tr>

                            <tr class="accordion-body" id="accordion-body-${item._source.doc.reference_id}">
                                        <td colspan=6 class="accordion-subtable-container">
                                        <table class="table accordion-subtable">
                                            <colgroup>
                                                <col class="colgroup-xl-col">
                                                <col class="colgroup-medium-col">
                                                <col>
                                            </colgroup>
                                            <tr>
                                                <th>Cited in the following Policy Document(s)</th>
                                                <th>Policy Organisation</th>
                                                <th></th>
                                            </tr>

                                <tr>
                                <td title="${policy_title}"><a
                                   href="${policy.source_url}"
                                   target="_blank"
                                   rel="noreferrer noopener"
                                >Foo</a></td>
                                <td>Bar</td>
                                <td>2020</td>
                            </table></td>
                            </tr>
                            <tr class="accordion-row" id="accordion-row-${item._source.doc.reference_id}">
                            <td class="accordion-arrow"><i class="icon icon-arrow-down mr-1"></i></td>
                            <td title="${match_title}">Foo</td>
                            <td>Bar</td>
                            <td class="authors-cell" title="${authors}">
                                Foo, Bar, Baz
                            </td>
                            <td>2020</td>
                            <td>1</td>
                            </tr>
                            <tr class="accordion-row" id="accordion-row-${item._source.doc.reference_id}">
                            <td class="accordion-arrow"><i class="icon icon-arrow-down mr-1"></i></td>
                            <td title="${match_title}">Foo</td>
                            <td>Bar</td>
                            <td class="authors-cell" title="${authors}">
                                Foo, Bar, Baz
                            </td>
                            <td>2020</td>
                            <td>1</td>
                            </tr>
                            <tr class="accordion-row" id="accordion-row-${item._source.doc.reference_id}">
                            <td class="accordion-arrow"><i class="icon icon-arrow-down mr-1"></i></td>
                            <td title="${match_title}">Foo</td>
                            <td>Bar</td>
                            <td class="authors-cell" title="${authors}">
                                Foo, Bar, Baz
                            </td>
                            <td>2020</td>
                            <td>1</td>
                            </tr> -->
                        </tbody>
                    </table>
                    <div class="columns">
                        <div class="column col-6 col-md-12">
                        </div>
                        <div class="column col-6 col-md-12">
                            <div class="pagination-box float-right" id="pagination-box">
                                {#- Updated dynamically in JS #}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <hr class="fs">
            <div class="columns">
                <div class="column col-6 col-md-12">
                    <div class="feedback-box">
                        <p class="bold">About these results</p>
                        <p>To learn more about how reach works and how it has generated these results, go to the <a href="/how-it-works">How Reach works</a> page</p>
                    </div>
                </div>
                <div class="column col-6 col-md-12">
                    <div class="feedback-box">
                        <p class="bold">Can't find what you're looking for?</p>
                        <p>If something doesn’t look quite right, please get in touch with the team at <a href="mailto:reach@wellcome.ac.uk">reach@wellcome.ac.uk</a></p>
                    </div>
                </div>
            </div>
            <hr class="fs">
        {% endif %}
</section>
{% endblock %}
